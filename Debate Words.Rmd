---
title: "Looking for Differences in Debate Words"
author: "Winston Saunders"
date: "November 18, 2015"
output: 
    html_document:
        theme: united
---

###SUMMARY
This analysis is based on the premise that widening political divisions are not just about "what to do" but, more fundamentally, about "what the actual problem is." For instance even the conservative [National Review](http://www.brookings.edu/blogs/fixgov/posts/2015/06/03-iowa-bloomberg-galston) highlighted disagreement about the most important issues.  
Here, using standard NLP (Natural Lanuguage Processing) techniques, I explore this question looking for differences in the lanuguage of presidential candidates using texts from recent Republican and Democratic debates. 
Key findings are:
1. "Wordcloud" visualization shows differences, though more surprising are similarities between candidates of different parties
2. Word associations 


###DATA SOURCES AND METHODS
The text of the presidential debates are downloaded from the [UCSB Presidency Project](http://www.presidency.ucsb.edu/debates.php). Transcripts were pasted into Apple Pages and stored as unformated .txt files. From that point all processing is done with __R__ using capabilities of {tm} and associated libraries.  

  

###CANDIDATE WORD-CLOUDS

The quickest and most visual method to compare texts is word-frequency analysis using wordclouds. 
Not surprisingly, word choices vary significantly between candidates. However, there are also some striking similarities.  

```{r, echo=FALSE, warning=FALSE, message=FALSE}


load_debate_text <- function(file_name){

## GET THE DATA
    
    ## data are the raw text files downloaded from the UCSB website.
    
    directory <- "/Users/winstonsaunders/Documents/Presidential_Debates_2015/"
    mydata <- read.table(paste0(directory, file_name), header=FALSE, sep="\n", stringsAsFactors = FALSE, quote = "")

    ## This is what a sample of the the raw data looks like
    ## mydata[100:105,1]
        # [1] "QUINTANILLA: Hold it. We'll cut it back to..."
        # [2] "QUICK: Dr. Carson, let's talk about taxes."
        # [3] "You have a flat tax plan of 10 percent flat taxes..."
        # [4] "If you were to took a 10 percent tax..."
        # [5] "So what analysis got you to the point where you think this will work?"
        # [6] "CARSON: Well, first of all..."

## ADD COLUMNS OF NUMBERS AND SEPARATE TEXT FROM CANDIDATE NAMES
    ## Add number column
    #mydata$n<-1:nrow(mydata)
    
    ## get rid of "..."
    #mydata$V1<-gsub("...", "", mydata$V1)
    
    ## This regex gets rid of all but the capitalized names
    mydata$name <- gsub(":.+|^[A-Z][^A-Z].+", "", mydata$V1 )

    ## Fill in the blank rows
    for (i in 2: nrow(mydata)){
        if (mydata$name[i] == "") mydata$name[i] <- mydata$name[i-1]
    }

    ## CREATE COLUMN OF DEBATE TEXT AND CLEAN UP BLANK SPACES
    mydata$text <- gsub (".", "", mydata$V1, fixed=TRUE)
    mydata$text <- gsub ("'", "", mydata$text)
    mydata$text <- gsub ("=", "", mydata$text)
    mydata$text <- tolower(mydata$text)
    mydata$text <- gsub ("[A-Z]{2,}: ", "", mydata$text)
    mydata$text <- gsub ("   ", " ", mydata$text)
    mydata$text <- gsub ("  ", " ", mydata$text)
    mydata$text <- gsub ("americans", "american", mydata$text)
    
    
    
    ## the data frame now contains four columns which look like this...
    
        #   50 Our greatest days lie ahead...
        #   51 QUINTANILLA: Mr. Trump?
        #   52 TRUMP: I think maybe ...[laughter]
        #     n        name
        # 50 50       RUBIO
        # 51 51 QUINTANILLA
        # 52 52       TRUMP
        # text
        # 50  Our greatest days lie ahead ....
        # 51  Mr. Trump?
        # 52  I think maybe my greatest weakness ... [laughter]
    
    return(mydata)
}

```

```{r echo=FALSE, warning=FALSE, message=FALSE}

candidate_text <- function(candidate, mydata){
    ## 
    ## GET CANDIDATE TEXT
    ##
    ## Assumes load_debate_text has been run and the debate text is stored in "mydata"
    ## creates a text list
    
  
    
    ## filter for candidate
    text<-mydata$text[mydata$name==candidate]
    text<-paste(text, collapse = " ")

    return(text)


}
```


```{r echo=13:22, warning=FALSE, message=FALSE}

    library(tm)
    library(RWeka)

text_tc <- function(mydata){
    ## 
    ## 
    ##
    ## Assumes text is stored in "mydata"
    ## creates a Corpus from the text
    ## filters some words out 

    require(tm)
    require(SnowballC)

    t_c <- Corpus(VectorSource(text))
    t_c <- tm_map(t_c, content_transformer(tolower))
    t_c <- tm_map(t_c, removePunctuation)
    t_c <- tm_map(t_c, removeNumbers)
    t_c <- tm_map(t_c, removeWords, stopwords("english"))
    t_c <- tm_map(t_c, removeWords, c("applause", "thats"))

    return(t_c)   
    
} 

```


```{r echo=FALSE, warning=FALSE, message=FALSE}

    library(tm)
    library(RWeka)

candidate_text_tc <- function(candidate, mydata){
    ## 
    ## GET CANDIDATE DATA
    ##
    ## Assumes load_debate_text has been run and the debate text is stored in "mydata"
    ## creates a Corpus from the candidate text
    
  
    
    ## filter for candidate
    text<-mydata$text[mydata$name==candidate]
    text<-paste(text, collapse = " ")

    require(tm)
    require(SnowballC)

    t_c <- Corpus(VectorSource(text))
    t_c <- tm_map(t_c, content_transformer(tolower))
    t_c <- tm_map(t_c, removePunctuation)
    t_c <- tm_map(t_c, removeNumbers)
    t_c <- tm_map(t_c, removeWords, stopwords("english"))
    t_c <- tm_map(t_c, removeWords, c("applause", "thats", "laughter", "dont", "back", "can", "get", "cant"))

    return(t_c)   
    
} 

```

```{r echo=FALSE, warning=FALSE, message=FALSE}

library(wordcloud)
library(RColorBrewer)

c_wordcloud <- function(t_c){
    
    ## 
    ## CREATE WORD CLOUD
    ##
    ## Assumes a text Corpus has been created
    ## 
    
    set.seed(8675309)
    
   
    color_map2<-c("#00003B","#041851","#4E0812" ,"#051E65", "#650A16", "#103374",  "#9F1A2D", "#482B25")
    
    wordcloud(t_c, scale=c(4,0.4), max.words=40, min.freq=4, random.order=FALSE, rot.per=0.2, use.r.layout=FALSE, colors=color_map2)

    

}

```



```{r, echo=FALSE, warning=FALSE, message=FALSE}

    ## GET ALL REPUB DEBATES
     file_name<-"Republican Candidates Debate in Boulder Colorado October 28 2015.txt"
     r_oct<-load_debate_text(file_name)
     #r_oct$date<-"Oct"
     file_name<-"Republican Candidates Debate in Milwaukee Wisconsin November 10 2015.txt"
     r_nov<-load_debate_text(file_name)
     #r_nov$date<-"Nov"
    
    r_all = rbind(r_oct, r_nov)
        ## slim down data a bit
        ## reduce data to about 30%
#         r_all<-r_all[grepl("RUBIO", r_all$name)|
#                          grepl("CARSON", r_all$name)|
#                          grepl("TRUMP", r_all$name)|
#                          grepl("CRUZ", r_all$name)|
#                          grepl("HUCKABEE", r_all$name)|
#                          grepl("FIORINA", r_all$name), ]
    
    
    
    ## GET ALL DEMO DEBATES
     file_name<-"Democratic Candidates Debate in Las Vegas Nevada October 13 2015 .txt"
     d_oct<-load_debate_text(file_name)
     file_name<-"Democratic Candidates Debate in Des Monies Iowa November 14 2015 .txt"
     d_nov<-load_debate_text(file_name)
    
    d_all = rbind(d_oct, d_nov)
    
    ## CREATE TCs FOR EACH CANDIDATE
    trump_all<-candidate_text_tc("TRUMP",r_all)
    rubio_all<-candidate_text_tc("RUBIO",r_all)
    fiorina_all<-candidate_text_tc("FIORINA",r_all)
    carson_all<-candidate_text_tc("CARSON",r_all)
    cruz_all<-candidate_text_tc("CRUZ",r_all)
    huckabee_all<-candidate_text_tc("HUCKABEE",r_all)
    bush_all<-candidate_text_tc("BUSH",r_all)

    clinton_all<-candidate_text_tc("CLINTON",d_all)
    sanders_all<-candidate_text_tc("SANDERS",d_all)
    
    
    
```


<style>
  .col2 {
    columns: 2 300px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 300px; /* chrome, safari */
    -moz-columns: 2 300px;    /* firefox */
  }
  .col3 {
    columns: 3 200px;
    -webkit-columns: 3 200px;
    -moz-columns: 3 200px;
  }
</style>




Let's first just look at the word clouds of different candidates. Are there differences in the word frequencies used by candidates from different parties. Are there differences within the same party? 

####THE POPULISTS: TRUMP AND SANDERS

Here are the word cloud of Donald Trump's and Bernie Sanders's dialogue at the debates. It's surprising that their frequent word choices like _people_, _country_, and _going_ are common, as if they are both painting a vision of the future that is personal (though radically different in nature).

<div class="col2">


```{r, echo=TRUE, message=FALSE, fig.align="center", results="asis"}
c_wordcloud(trump_all)
c_wordcloud(sanders_all)
```

</div>

####THE WOMEN: HILARY AND CARLY

In this case word clouds couldn't be more different. Hilary's emphasizes _think_ and _people_ while Carly's, a former business woman, primarily emphasizes _government_. 

<div class="col2">


```{r, echo=TRUE, message=FALSE, fig.align="center", results="asis"}
c_wordcloud(clinton_all)
c_wordcloud(fiorina_all)
```

</div>

####WONK AND BOMBAST: CRUZ AND HUCKABEE

Ted Cruz's wordcloud emphasizes on wonkish technicalities, like _taxes_, _growth_, and _percentages_, while that of Mike Huckabee, a former minister, highlights _people_,  _government_, and _money_. 

<div class="col2">


```{r, echo=TRUE, message=FALSE, fig.align="center", results="asis"}
c_wordcloud(cruz_all)
c_wordcloud(huckabee_all)
```

</div>


###STAYING ON MESSAGE: COMPARING DEBATES

We can also split the text by debate. Since the debates cover different topics and questions, one might expect to see this reflected in the text of the separate dialogues. What's surprising here is how comparable the language of each candidate is between the debates.

<div class="col2">


```{r, echo=TRUE, message=FALSE, fig.align="center", results="asis"}
c_wordcloud(candidate_text_tc("TRUMP", r_oct))
c_wordcloud(candidate_text_tc("TRUMP", r_nov))
```
</div>

<div class="col2">


```{r, echo=TRUE, message=FALSE, fig.align="center", results="asis"}
c_wordcloud(candidate_text_tc("SANDERS", d_oct))
c_wordcloud(candidate_text_tc("SANDERS", d_nov))
```
</div>

####CONCLUSIONS

Word clouds reveal differences between candidate word choices between candidates which hint at political preferences and opinions, but do not reveal significant differences in opinion about policy on important matters like taxes, terrorism, immigration, and class division. 

###WORD FREQUENCY

We can check word frequency directly by simply counting single words and looking for the most frequent words used by each candidate. 


<style>

table { 
    width: 80%;
    display: table;
    border-collapse: collapse;
    border-spacing: 18px;
    border-color: gray;
    background-color: #91c2e3;
    text-align: center;
    font: 18px arial, sans-serif;
}
th{
    text-align: center;
}, td {
    
    padding: 6px;
}
</style>


```{r, echo=FALSE}

## Create Term_Document_Matrices

TDM_trump <- TermDocumentMatrix(trump_all)
TDM_rubio <- TermDocumentMatrix(rubio_all)
TDM_fiorina <- TermDocumentMatrix(fiorina_all)
TDM_carson <- TermDocumentMatrix(carson_all)
TDM_cruz <- TermDocumentMatrix(cruz_all)
TDM_huckabee <- TermDocumentMatrix(huckabee_all)
TDM_bush <- TermDocumentMatrix(bush_all)

TDM_clinton <- TermDocumentMatrix(clinton_all)
TDM_sanders <- TermDocumentMatrix(sanders_all)


```



```{r, echo=FALSE}

findAssocs_candidate<-function(TDM, term){
    ## reduce to lower case
    term<-tolower(term)
    ## find associations
    x<-findAssocs(TDM, term, 0.5)
    return(x)
    
}


```

```{r, echo=FALSE, results='asis', fig.align='center'}

library(xtable)

row_names <- c("Trump", "Sanders", "Clinton", "Fiorina", "Cruz", "Rubio" )
col_names <- c("First", "Second", "Third", "Fourth", "Fifth")

word_mat<-matrix(
    c(findFreqTerms(TDM_trump, 15)[1:5],
      findFreqTerms(TDM_sanders, 20)[1:5],
      findFreqTerms(TDM_clinton, 20)[1:5],
      findFreqTerms(TDM_fiorina, 10)[1:5],
      findFreqTerms(TDM_cruz, 10)[1:5],
      findFreqTerms(TDM_rubio, 10)[1:5]), nrow = 6, byrow = TRUE, dimnames = list(row_names ,col_names ) )

word_df<-as.data.frame(word_mat)

print(xtable(word_df), type='html', comment=FALSE, include.rownames=TRUE, 
      html.table.attributes='border="3" align="center" ' )


```


```{r, echo=FALSE}

#findAssocs_candidate(TDM_trump,"country")
# findAssocs_candidate(TDM_sanders,"people")
# findAssocs_candidate(TDM_clinton,"people")
# findAssocs_candidate(TDM_fiorina,"people")

```




```{r, echo=FALSE}

library(RWeka)
bigramTokenizer <- function(x) NGramTokenizer(x, 
                                Weka_control(min = 2, max = 2))

trump_bigrams <- sort(table(bigramTokenizer(trump_all)), decreasing = TRUE)
sanders_bigrams <- sort(table(bigramTokenizer(sanders_all)), decreasing = TRUE)
clinton_bigrams <- sort(table(bigramTokenizer(clinton_all)), decreasing = TRUE)
fiorina_bigrams <- sort(table(bigramTokenizer(fiorina_all)), decreasing = TRUE)

bigram_finder <- function(word, bigram_table){
    relevant_bigrams <- bigram_table[grep(word, rownames(bigram_table), ignore.case=TRUE)]
    return(relevant_bigrams)
}

```

###TRUMP ON...

The word __wall__ can be used in many contexts. Donald Trump mentions it in 

```{r, echo=FALSE}


bigram_finder("wall", trump_bigrams)[1:3]
bigram_finder("class", trump_bigrams)[1:3]
bigram_finder("terror", trump_bigrams)[1:3]
bigram_finder("tax", trump_bigrams)[1:3]
bigram_finder("terror", trump_bigrams)[1:3]

```
###FIORINA
```{r, echo=FALSE}
bigram_finder("country", fiorina_bigrams)[1:3]
bigram_finder("wall", fiorina_bigrams)[1:3]
bigram_finder("class", fiorina_bigrams)[1:3]
bigram_finder("tax", fiorina_bigrams)[1:3]
bigram_finder("terror", fiorina_bigrams)[1:3]

```
###SANDERS
```{r, echo=FALSE}

bigram_finder("country", sanders_bigrams)[1:3]
bigram_finder("wall", sanders_bigrams)[1:3]
bigram_finder("class", sanders_bigrams)[1:3]
bigram_finder("tax", sanders_bigrams)[1:3]
bigram_finder("terror", sanders_bigrams)[1:3]
```
###CLINTON
```{r, echo=FALSE}
bigram_finder("country", clinton_bigrams)[1:3]
bigram_finder("wall", clinton_bigrams)[1:3]
bigram_finder("class", clinton_bigrams)[1:3]
bigram_finder("tax", clinton_bigrams)[1:3]
bigram_finder("terror", clinton_bigrams)[1:3]




```